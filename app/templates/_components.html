{# --- Macro para o Card de Item (usado no index.html) --- #}
{% macro item_card(item) %}
<div class="item-card" onclick="otimizar('{{ item.item_code }}')" data-search="{{ item.item_code|lower }} {{ item.item_name|lower }}">
    {% if item.demanda > item.estoque_atual %}
    <span class="priority-badge priority-high">PRIORIDADE ALTA</span>
    {% else %}
    <span class="priority-badge priority-low">ESTOQUE</span>
    {% endif %}
    
    <div class="item-code">{{ item.item_code }}</div>
    <div class="item-name">{{ item.item_name }}</div>
    
    <div class="item-specs">
        <div class="spec-item">
            <span class="spec-label">Espessura</span>
            <span class="spec-value">{{ "%.1f"|format(item.espessura) }} mm</span>
        </div>
        <div class="spec-item">
            <span class="spec-label">Desenvolv.</span>
            <span class="spec-value">{{ "%.1f"|format(item.desenvolvimento) }} mm</span>
        </div>
    </div>
    
    <div class="item-demand">
        <div class="demand-box {% if item.demanda > item.estoque_atual %}high{% endif %}">
            <div class="demand-label">Demanda</div>
            <div class="demand-value">{{ item.demanda }}</div>
        </div>
        <div class="demand-box">
            <div class="demand-label">Estoque</div>
            <div class="demand-value">{{ item.estoque_atual }}</div>
        </div>
        <div class="demand-box">
            <div class="demand-label">M√°ximo</div>
            <div class="demand-value">{{ item.estoque_maximo }}</div>
        </div>
    </div>
</div>
{% endmacro %}


{# --- Macro para o Card de Padr√£o (usado no results.html) --- #}
{% macro pattern_card(padrao, loop) %}
<div class="pattern-card">
    
    <div class="pattern-header">
        <div class="pattern-rank">#{{ loop.index }}</div>
        <div class="pattern-metrics">
            <div class="metric-box">
                <div class="metric-label">Desperd√≠cio (mm)</div>
                <div class="metric-value warning">{{ "%.1f"|format(padrao.desperdicio) }}</div>
            </div>
            <div class="metric-box">
                <div class="metric-label">Utiliza√ß√£o (%)</div>
                <div class="metric-value good">{{ "%.1f"|format(padrao.utilizacao_percentual) }}</div>
            </div>
            <div class="metric-box">
                <div class="metric-label">Score Prioridade</div>
                <div class="metric-value excellent">{{ padrao.score_prioridade }}</div>
            </div>
        </div>
    </div>
    
    <div class="visual-bar">
        <div class="visual-bar-used" style="width: {{ padrao.utilizacao_percentual }}%;">
            {{ "%.1f"|format(padrao.utilizacao_percentual) }}%
        </div>
        <div class="visual-bar-waste">
            Perda: {{ "%.1f"|format(padrao.desperdicio) }}mm
        </div>
    </div>
    
    <div class="items-list">
        <h4>Composi√ß√£o do Padr√£o:</h4>
        
        <div class="item-row item-row-header">
            <div class="item-code-col">Item</div>
            <div>Nome</div>
            <div>Qtd.</div>
            <div>Desenvolv. (mm)</div>
            <div>Prioridade</div>
        </div>
        
        {% for item, qty in padrao.combinacao %}
        <div class="item-row">
            <div class="item-code-col">
                {% if item.prioridade >= 10 %}
                    <span class="priority-indicator priority-high"></span>
                {% else %}
                    <span class="priority-indicator priority-low"></span>
                {% endif %}
                {{ item.item_code }}
            </div>
            <div>{{ item.item_name }}</div>
            <div><strong>{{ qty }}</strong></div>
            <div>{{ item.desenvolvimento }}</div>
            <div>{{ item.prioridade }}</div>
        </div>
        {% endfor %}
    </div>
    
    <div class="export-buttons">
        <button class="export-btn" onclick="imprimirPadrao({{ loop.index }})">üñ®Ô∏è Imprimir Padr√£o</button>
        <button class="export-btn" onclick="copiarPadrao({{ loop.index }})">üìã Copiar para Clipboard</button>
    </div>
</div>
{% endmacro %}